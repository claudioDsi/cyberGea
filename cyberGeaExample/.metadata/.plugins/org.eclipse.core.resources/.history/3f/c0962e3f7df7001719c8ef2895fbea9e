package org.cybergea.datanalyzer;

import java.sql.SQLException;

import org.cybergea.dbmanager.DataExchange;
import org.osgi.framework.BundleContext;
import org.osgi.framework.ServiceReference;
import org.osgi.util.tracker.ServiceTrackerCustomizer;

public class TrackerCustomizer implements ServiceTrackerCustomizer
{
	private Thread t;
    private final BundleContext context;
    private PresentationUpdater disp;

    
    public TrackerCustomizer(BundleContext context, PresentationUpdater disp) 
    {
        this.context = context;
        this.disp = disp;
    }

	@Override
	public Object addingService(ServiceReference ref) 
	{				
		disp.bindDataExchange((DataExchange)context.getService(ref));
		
		t = new Thread(new Runnable()
        {
			private boolean active = true;

			@Override
			public void run() 
			{
				try {
					disp.printData();
				} catch (SQLException e1) {
					// TODO Auto-generated catch block
					e1.printStackTrace();
				}
				
				try
				{
					Thread.sleep(50);
					disp.printData();
					
				}catch(Exception e)
				{
					System.out.println(e.getMessage());
				}
			}
			
			public void stopThread()
			{
				this.active = false;
			}
        	
        });
		
		t.start();
		return disp;
	}

	@Override
	public void modifiedService(ServiceReference arg0, Object arg1)
	{
		// TODO Auto-generated method stub
		
	}

	@Override
	public void removedService(ServiceReference arg0, Object arg1) 
	{
		context.ungetService(arg0);
		System.out.println("How sad. Service is gone");
	}

}
