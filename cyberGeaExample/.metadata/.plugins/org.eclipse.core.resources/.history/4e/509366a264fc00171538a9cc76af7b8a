package org.cyberGea.eventGenerators;

import org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;
import org.eclipse.paho.client.mqttv3.MqttCallback;
import org.eclipse.paho.client.mqttv3.MqttClient;
import org.eclipse.paho.client.mqttv3.MqttConnectOptions;
import org.eclipse.paho.client.mqttv3.MqttException;
import org.eclipse.paho.client.mqttv3.MqttMessage;

public class Camera extends Sensor implements MqttCallback{
	Thread t;
	MqttClient sub;
	String name;
	int growth;
	String[] product;
	
	public Camera(DataPublisher clientReference, int min, int max, String name,String[] product) {
		super(clientReference,"rawData/camera",0,100,product);
		this.name=name;
		this.growth=min;
		
		measureMaturity();
		try {
			setSub();
		} catch (MqttException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	/*
	 * Subscriber Part
	 */

	
	public void setSub() throws MqttException
	{
		sub = new MqttClient("tcp://localhost:1883","cameraSub");
		MqttConnectOptions opts = new MqttConnectOptions();	
		sub.setCallback(this);
		sub.connect(opts);		
		sub.subscribe("startcamera");
	}

	public void measureMaturity()
	{
		System.out.println(name + " is turn on");
		t = new Thread(this);
		t.start();
	}
	
	public void stopCamera() throws InterruptedException
	{
		this.stopThread();
		System.out.println(name + " is turn off");
	}

	@Override
	public void connectionLost(Throwable arg0) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void deliveryComplete(IMqttDeliveryToken arg0) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void messageArrived(String arg0, MqttMessage arg1) throws Exception {
		System.out.println("Arrived " + arg1.toString());
		this.product=arg1.toString().split(",");
		
	}

}
